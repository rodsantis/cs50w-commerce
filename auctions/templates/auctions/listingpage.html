{% extends "auctions/layout.html" %}

{% block body %}
        <h2>Listing: {{ listing.title }} </h2>
        {% if listing.img %}
        <section>
            <figure>
                <img src="{{ listing.img.url }}" alt="Listed item image" style="width: 300px;">
            </figure>
        </section>
        {% endif %}
        <p>Description: {{ listing.description }}</p>
        <h3>Current price: ${{ listing.price }} </h3>
        {% if user.is_authenticated and not_active == False%}
            <!-- Adding or removing watch list -->
            <div>
                <form style="display: inline-block;" action="{% url 'watchlist' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="watchlist" value="{{ listing.pk }}">
                    <button type="submit">Watchlist</button>
                </form>
            </div>
            <!-- Bidding for the product -->
            {% if message %}
                <h4 style="padding-top: 10px;">{{ message }}</h4>
            {% endif %}
            {% if winning_bid %}
                {% if winning_bid == request.user %}
                    <h6 style="padding-top: 10px;">Your Bid is the current bid!</h6>
                {% else %}
                    <h6 style="padding-top: 10px;">The current Bid is from {{ winning_bid }}!</h6>
                {% endif %}
            {% endif %}
        {% endif %}
        {% if not_active == True and user.is_authenticated %}
            {% if winning_bid == request.user %}
                <h3>You Won!! This Listing was bought by You !!!!</h3>
            {% else %}
                <h3>This Listing was bought by: {{ winning_bid }}!!!!</h3>
            {% endif %}
        {% else %}
            {% if user.is_authenticated %}
            <div style="padding-top: 10px;">
                <form action="{% url 'listing_page' listing.pk %}" method="post">
                    {% csrf_token %}
                    <div class="form-group row" style="display: inline-block;">
                        <div class="col-sm-10" >
                            {{ bid_form }}
                        </div>
                    </div>
                    <div class="form-group row" style="display: inline-block;">
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-primary">Bid</button>
                        </div>
                    </div>
                </form>
            </div>
            {% endif %}
        {% endif %}
        <div>
            {% if listing.username == request.user and not_active == False %}
            <form action="{% url 'listing_page' listing.pk %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="sold" value="{{ listing.pk }}">
                <button type="submit">Sell</button>
            </form>
            {% endif %}
        </div>
        <h4>Details:</h4>
        <ul>
            <li>Listed by: {{ listing.username }} </li>
            <li>Category: {{ listing.category }} </li>
        </ul>
{% endblock %}